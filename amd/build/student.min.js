define(["jquery","mod_jazzquiz/core"],function(i,n){const t=n.Quiz,e=n.Question,o=n.Ajax,s=n.setText;class u{constructor(n){this.quiz=n,this.voteAnswer=void 0;let t=this;i(document).on("submit","#jazzquiz_question_form",function(i){i.preventDefault(),t.submitAnswer()}).on("click","#jazzquiz_save_vote",function(){t.saveVote()}).on("click",".jazzquiz-select-vote",function(){t.voteAnswer=this.value})}onNotRunning(i){s(t.info,"instructions_for_student")}onPreparing(i){s(t.info,"wait_for_instructor")}onRunning(i){if(this.quiz.question.isRunning)return;this.quiz.question.startCountdown(i.questiontime,i.delay)||s(t.info,"wait_for_instructor")}onReviewing(i){this.quiz.question.isVoteRunning=!1,this.quiz.question.isRunning=!1,this.quiz.question.hideTimer(),t.hide(e.box),s(t.info,"wait_for_instructor")}onSessionClosed(i){s(t.info,"session_closed")}onVoting(i){if(this.quiz.question.isVoteRunning)return;t.info.html(i.html);const n=i.options;for(let i=0;i<n.length;i++)t.addMathjaxElement(n[i].content_id,n[i].text),"stack"===n[i].question_type&&t.renderMaximaEquation(n[i].text,n[i].content_id);this.quiz.question.isVoteRunning=!0}onStateChange(i){}onQuestionTimerEnding(){}onTimerTick(i){s(e.timer,"question_will_end_in_x_seconds","jazzquiz",i)}submitAnswer(){if(this.quiz.question.hideTimer(),this.quiz.question.isSaving)return;this.quiz.question.isSaving=!0,"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();const i=e.form.serializeArray();let n={};for(let t in i)i.hasOwnProperty(t)&&(n[i[t].name]=i[t].value);o.post("save_question",n,i=>{i.feedback.length>0?t.show(t.info.html(i.feedback)):s(t.info,"wait_for_instructor"),this.quiz.question.isSaving=!1,this.quiz.question.isRunning&&(this.quiz.question.isVoteRunning||t.hide(e.box))}).fail(()=>{this.quiz.question.isSaving=!1})}saveVote(){o.post("save_vote",{vote:this.voteAnswer},i=>{"success"===i.status?s(t.info,"wait_for_instructor"):s(t.info,"you_already_voted")})}}return{initialize:()=>{new t(u).poll(2e3)}}});