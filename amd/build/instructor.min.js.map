{"version":3,"sources":["../src/instructor.js"],"names":["define","$","Jazz","Quiz","Question","Ajax","setText","ResponseView","quiz","currentResponses","showVotesUponReview","respondedCount","showResponses","totalStudents","document","on","undoMerge","event","target","classList","contains","startMerge","id","parentNode","refresh","refreshVotes","responses","html","responseInfo","uncheck","Instructor","control","hide","check","show","removeClass","post","from","into","fromRowBarId","$barCell","$row","parent","hasClass","endMerge","$fromRow","merge","data","addClass","$table","find","each","$cells","attr","name","question","hasVotes","state","$showNormalResult","$showVoteResult","length","children","append","remove","targetId","graphId","rebuild","getElementById","total","highestResponseCount","i","count","parseInt","innerHTML","prune","rows","j","dataset","response","deleteRow","createControls","percent","rowIndex","currentRowIndex","row_i","row","insertRow","response_i","add","countHtml","responseCell","insertCell","onclick","toggleClass","barCell","latexId","addMathjaxElement","qtype","renderMaximaEquation","currentRow","containsOutside","countElement","barElement","firstElementChild","style","width","wrapperId","tableId","responded","questionType","a","b","trim","replace","exists","push","createBarGraph","sortBarGraph","get","has_votes","total_students","set","question_type","merge_count","answers","hasOwnProperty","attempt","finalcount","slot","isSorting","current","next","insertBefore","isShowingCorrectAnswer","totalQuestions","allowVote","keyCode","closeFullscreenView","closeQuestionListMenu","addEvents","repollQuestion","runVoting","showQuestionListSetup","nextQuestion","randomQuestion","endQuestion","showFullscreenView","showCorrectAnswer","toggle","closeSession","startQuiz","addHotkeys","student_count","side","info","enableControls","controlButtons","$studentsJoined","enabledButtons","questionTime","questiontime","isRunning","delay","isMerging","started","startCountdown","isLoaded","isNewState","correctAnswer","clear","css","voteable","timeLeft","timer","hideTimer","$controlButton","$menu","menuMargin","offset","left","questions","$questionButton","time","questionid","jazzquizquestionid","questionId","jazzQuestionId","jumpQuestion","options","getSelectedAnswersForVote","encodeURIComponent","JSON","stringify","method","jazzquizQuestionId","hideCorrectAnswer","startQuestion","box","controls","window","location","href","split","right_answer","renderAllMathjax","keys","key","action","repeat","ctrlKey","String","fromCharCode","which","toLowerCase","focusedTag","prop","preventDefault","$control","click","events","result","option","text","buttons","index","child","getAttribute","disabled","indexOf","main","documentElement","overflowY","menuId","menu","closest","fadeIn","fadeOut","initialize","reportView","slots","role","addReportEventHandlers","forEach","wrapper","num","table","graph","type","poll"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package   mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastsg@stud.ntnu.no>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'mod_jazzquiz/core'], function ($, Jazz) {\n\n\tconst Quiz = Jazz.Quiz;\n\tconst Question = Jazz.Question;\n\tconst Ajax = Jazz.Ajax;\n\tconst setText = Jazz.setText;\n\n\tclass ResponseView {\n\n\t\t/**\n\t\t * @param {Quiz} quiz\n\t\t */\n\t\tconstructor(quiz) {\n\t\t\tthis.quiz = quiz;\n\t\t\tthis.currentResponses = [];\n\t\t\tthis.showVotesUponReview = false;\n\t\t\tthis.respondedCount = 0;\n\t\t\tthis.showResponses = false;\n\t\t\tthis.totalStudents = 0;\n\t\t\t$(document).on('click', '#jazzquiz_undo_merge', () => this.undoMerge());\n\t\t\t$(document).on('click', event => {\n\t\t\t\t// Clicking a row to merge.\n\t\t\t\tif (event.target.classList.contains('bar')) {\n\t\t\t\t\tthis.startMerge(event.target.id);\n\t\t\t\t} else if (event.target.parentNode && event.target.parentNode.classList.contains('bar')) {\n\t\t\t\t\tthis.startMerge(event.target.parentNode.id);\n\t\t\t\t}\n\t\t\t});\n\t\t\t$(document).on('click', '#review_show_normal_results', () => this.refresh(false));\n\t\t\t$(document).on('click', '#review_show_vote_results', () => this.refreshVotes());\n\t\t}\n\n\t\t/**\n\t\t * Clear, but not hide responses.\n\t\t */\n\t\tclear() {\n\t\t\tQuiz.responses.html('');\n\t\t\tQuiz.responseInfo.html('');\n\t\t}\n\n\t\t/**\n\t\t * Hides the responses\n\t\t */\n\t\thide() {\n\t\t\tQuiz.uncheck(Instructor.control('responses'));\n\t\t\tQuiz.hide(Quiz.responses);\n\t\t\tQuiz.hide(Quiz.responseInfo);\n\t\t}\n\n\t\t/**\n\t\t * Shows the responses\n\t\t */\n\t\tshow() {\n\t\t\tQuiz.check(Instructor.control('responses'));\n\t\t\tQuiz.show(Quiz.responses);\n\t\t\tQuiz.show(Quiz.responseInfo);\n\t\t\tif (this.showVotesUponReview) {\n\t\t\t\tthis.refreshVotes();\n\t\t\t\tthis.showVotesUponReview = false;\n\t\t\t} else {\n\t\t\t\tthis.refresh(false);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Toggle whether to show or hide the responses\n\t\t */\n\t\ttoggle() {\n\t\t\tthis.showResponses = !this.showResponses;\n\t\t\tif (this.showResponses) {\n\t\t\t\tthis.show();\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * End the response merge.\n\t\t */\n\t\tendMerge() {\n\t\t\t$('.merge-into').removeClass('merge-into');\n\t\t\t$('.merge-from').removeClass('merge-from');\n\t\t}\n\n\t\t/**\n\t\t * Undo the last response merge.\n\t\t */\n\t\tundoMerge() {\n\t\t\tAjax.post('undo_merge', {}, () => this.refresh(true));\n\t\t}\n\n\t\t/**\n\t\t * Merges responses based on response string.\n\t\t * @param {string} from\n\t\t * @param {string} into\n\t\t */\n\t\tmerge(from, into) {\n\t\t\tAjax.post('merge_responses', { from: from, into: into }, () => this.refresh(false));\n\t\t}\n\n\t\t/**\n\t\t * Start a merge between two responses.\n\t\t * @param {string} fromRowBarId\n\t\t */\n\t\tstartMerge(fromRowBarId) {\n\t\t\tconst $barCell = $('#' + fromRowBarId);\n\t\t\tlet $row = $barCell.parent();\n\t\t\tif ($row.hasClass('merge-from')) {\n\t\t\t\tthis.endMerge();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ($row.hasClass('merge-into')) {\n\t\t\t\tconst $fromRow = $('.merge-from');\n\t\t\t\tthis.merge($fromRow.data('response'), $row.data('response'));\n\t\t\t\tthis.endMerge();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$row.addClass('merge-from');\n\t\t\tlet $table = $row.parent().parent();\n\t\t\t$table.find('tr').each(function () {\n\t\t\t\tconst $cells = $(this).find('td');\n\t\t\t\tif ($cells[1].id !== $barCell.attr('id')) {\n\t\t\t\t\t$(this).addClass('merge-into');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Create controls to toggle between the responses of the actual question and the vote that followed.\n\t\t * @param {string} name Can be either 'vote_response' or 'current_response'\n\t\t */\n\t\tcreateControls(name) {\n\t\t\tif (!this.quiz.question.hasVotes) {\n\t\t\t\tQuiz.hide(Quiz.responseInfo);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Add button for instructor to change what to review.\n\t\t\tif (this.quiz.state === 'reviewing') {\n\t\t\t\tlet $showNormalResult = $('#review_show_normal_results');\n\t\t\t\tlet $showVoteResult = $('#review_show_vote_results');\n\t\t\t\tQuiz.show(Quiz.responseInfo);\n\t\t\t\tif (name === 'vote_response') {\n\t\t\t\t\tif ($showNormalResult.length === 0) {\n\t\t\t\t\t\tsetText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_vote_results');\n\t\t\t\t\t\tQuiz.responseInfo.append('<button id=\"review_show_normal_results\" class=\"btn btn-primary\"></button><br>');\n\t\t\t\t\t\tsetText($('#review_show_normal_results'), 'click_to_show_original_results');\n\t\t\t\t\t\t$showVoteResult.remove();\n\t\t\t\t\t}\n\t\t\t\t} else if (name === 'current_response') {\n\t\t\t\t\tif ($showVoteResult.length === 0) {\n\t\t\t\t\t\tsetText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_original_results');\n\t\t\t\t\t\tQuiz.responseInfo.append('<button id=\"review_show_vote_results\" class=\"btn btn-primary\"></button><br>');\n\t\t\t\t\t\tsetText($('#review_show_vote_results'), 'click_to_show_vote_results');\n\t\t\t\t\t\t$showNormalResult.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Create a new and unsorted response bar graph.\n\t\t * @param {Array.<Object>} responses\n\t\t * @param {string} name\n\t\t * @param {string} targetId\n\t\t * @param {string} graphId\n\t\t * @param {boolean} rebuild If the table should be completely rebuilt or not\n\t\t */\n\t\tcreateBarGraph(responses, name, targetId, graphId, rebuild) {\n\t\t\tlet target = document.getElementById(targetId);\n\t\t\tif (target === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet total = 0;\n\t\t\tlet highestResponseCount = 0;\n\t\t\tfor (let i = 0; i < responses.length; i++) {\n\t\t\t\tlet count = parseInt(responses[i].count); // In case count is a string.\n\t\t\t\ttotal += count;\n\t\t\t\tif (count > highestResponseCount) {\n\t\t\t\t\thighestResponseCount = count;\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif (total === 0) {\n\t\t\t\ttotal = 1;\n\t\t\t}\n\n\t\t\t// Remove the rows if it should be rebuilt.\n\t\t\tif (rebuild) {\n\t\t\t\ttarget.innerHTML = '';\n\t\t\t}\n\n\t\t\t// Prune rows.\n\t\t\tfor (let i = 0; i < target.rows.length; i++) {\n\t\t\t\tlet prune = true;\n\t\t\t\tfor (let j = 0; j < responses.length; j++) {\n\t\t\t\t\tif (target.rows[i].dataset.response === responses[j].response) {\n\t\t\t\t\t\tprune = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (prune) {\n\t\t\t\t\ttarget.deleteRow(i);\n\t\t\t\t\ti--;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.createControls(name);\n\n\t\t\tname += graphId;\n\n\t\t\t// Add rows.\n\t\t\tfor (let i = 0; i < responses.length; i++) {\n\t\t\t\t//const percent = (parseInt(responses[i].count) / total) * 100;\n\t\t\t\tconst percent = (parseInt(responses[i].count) / highestResponseCount) * 100;\n\n\t\t\t\t// Check if row with same response already exists.\n\t\t\t\tlet rowIndex = -1;\n\t\t\t\tlet currentRowIndex = -1;\n\t\t\t\tfor (let j = 0; j < target.rows.length; j++) {\n\t\t\t\t\tif (target.rows[j].dataset.response === responses[i].response) {\n\t\t\t\t\t\trowIndex = target.rows[j].dataset.row_i;\n\t\t\t\t\t\tcurrentRowIndex = j;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (rowIndex === -1) {\n\t\t\t\t\trowIndex = target.rows.length;\n\t\t\t\t\tlet row = target.insertRow();\n\t\t\t\t\trow.dataset.response_i = i;\n\t\t\t\t\trow.dataset.response = responses[i].response;\n\t\t\t\t\trow.dataset.percent = percent;\n\t\t\t\t\trow.dataset.row_i = rowIndex;\n\t\t\t\t\trow.dataset.count = responses[i].count;\n\t\t\t\t\trow.classList.add('selected-vote-option');\n\t\t\t\t\tif (percent < 15) {\n\t\t\t\t\t\trow.classList.add('outside');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst countHtml = '<span id=\"' + name + '_count_' + rowIndex + '\">' + responses[i].count + '</span>';\n\t\t\t\t\tlet responseCell = row.insertCell(0);\n\t\t\t\t\tresponseCell.onclick = function () {\n\t\t\t\t\t\t$(this).parent().toggleClass('selected-vote-option');\n\t\t\t\t\t};\n\n\t\t\t\t\tlet barCell = row.insertCell(1);\n\t\t\t\t\tbarCell.classList.add('bar');\n\t\t\t\t\tbarCell.id = name + '_bar_' + rowIndex;\n\t\t\t\t\tbarCell.innerHTML = '<div style=\"width:' + percent + '%;\">' + countHtml + '</div>';\n\n\t\t\t\t\tconst latexId = name + '_latex_' + rowIndex;\n\t\t\t\t\tresponseCell.innerHTML = '<span id=\"' + latexId + '\"></span>';\n\t\t\t\t\tQuiz.addMathjaxElement($('#' + latexId), responses[i].response);\n\t\t\t\t\tif (responses[i].qtype === 'stack') {\n\t\t\t\t\t\tQuiz.renderMaximaEquation(responses[i].response, latexId);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet currentRow = target.rows[currentRowIndex];\n\t\t\t\t\tcurrentRow.dataset.row_i = rowIndex;\n\t\t\t\t\tcurrentRow.dataset.response_i = i;\n\t\t\t\t\tcurrentRow.dataset.percent = percent;\n\t\t\t\t\tcurrentRow.dataset.count = responses[i].count;\n\t\t\t\t\tconst containsOutside = currentRow.classList.contains('outside');\n\t\t\t\t\tif (percent > 15 && containsOutside) {\n\t\t\t\t\t\tcurrentRow.classList.remove('outside');\n\t\t\t\t\t} else if (percent < 15 && !containsOutside) {\n\t\t\t\t\t\tcurrentRow.classList.add('outside');\n\t\t\t\t\t}\n\t\t\t\t\tlet countElement = document.getElementById(name + '_count_' + rowIndex);\n\t\t\t\t\tif (countElement !== null) {\n\t\t\t\t\t\tcountElement.innerHTML = responses[i].count;\n\t\t\t\t\t}\n\t\t\t\t\tlet barElement = document.getElementById(name + '_bar_' + rowIndex);\n\t\t\t\t\tif (barElement !== null) {\n\t\t\t\t\t\tbarElement.firstElementChild.style.width = percent + '%';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Sort the responses in the graph by how many had the same response.\n\t\t * @param {string} targetId\n\t\t */\n\t\tstatic sortBarGraph(targetId) {\n\t\t\tlet target = document.getElementById(targetId);\n\t\t\tif (target === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet isSorting = true;\n\t\t\twhile (isSorting) {\n\t\t\t\tisSorting = false;\n\t\t\t\tfor (let i = 0; i < (target.rows.length - 1); i++) {\n\t\t\t\t\tconst current = parseInt(target.rows[i].dataset.percent);\n\t\t\t\t\tconst next = parseInt(target.rows[i + 1].dataset.percent);\n\t\t\t\t\tif (current < next) {\n\t\t\t\t\t\ttarget.rows[i].parentNode.insertBefore(target.rows[i + 1], target.rows[i]);\n\t\t\t\t\t\tisSorting = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Create and sort a bar graph based on the responses passed.\n\t\t * @param {string} wrapperId\n\t\t * @param {string} tableId\n\t\t * @param {Array.<Object>} responses\n\t\t * @param {number|undefined} responded How many students responded to the question\n\t\t * @param {string} questionType\n\t\t * @param {string} graphId\n\t\t * @param {boolean} rebuild If the graph should be rebuilt or not.\n\t\t */\n\t\tset(wrapperId, tableId, responses, responded, questionType, graphId, rebuild) {\n\t\t\tif (responses === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if any responses to show.\n\t\t\tif (responses.length === 0) {\n\t\t\t\tQuiz.show(Quiz.responded);\n\t\t\t\tsetText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n\t\t\t\t\ta: 0,\n\t\t\t\t\tb: this.totalStudents\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Question type specific.\n\t\t\tswitch (questionType) {\n\t\t\t\tcase 'shortanswer':\n\t\t\t\t\tfor (let i = 0; i < responses.length; i++) {\n\t\t\t\t\t\tresponses[i].response = responses[i].response.trim();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'stack':\n\t\t\t\t\t// Remove all spaces from responses.\n\t\t\t\t\tfor (let i = 0; i < responses.length; i++) {\n\t\t\t\t\t\tresponses[i].response = responses[i].response.replace(/\\s/g, '');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// Update data.\n\t\t\tthis.currentResponses = [];\n\t\t\tthis.respondedCount = 0;\n\t\t\tfor (let i = 0; i < responses.length; i++) {\n\t\t\t\tlet exists = false;\n\t\t\t\tlet count = 1;\n\t\t\t\tif (responses[i].count !== undefined) {\n\t\t\t\t\tcount = parseInt(responses[i].count);\n\t\t\t\t}\n\t\t\t\tthis.respondedCount += count;\n\t\t\t\t// Check if response is a duplicate.\n\t\t\t\tfor (let j = 0; j < this.currentResponses.length; j++) {\n\t\t\t\t\tif (this.currentResponses[j].response === responses[i].response) {\n\t\t\t\t\t\tthis.currentResponses[j].count += count;\n\t\t\t\t\t\texists = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Add element if not a duplicate.\n\t\t\t\tif (!exists) {\n\t\t\t\t\tthis.currentResponses.push({\n\t\t\t\t\t\tresponse: responses[i].response,\n\t\t\t\t\t\tcount: count,\n\t\t\t\t\t\tqtype: questionType\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update responded container.\n\t\t\tif (Quiz.responded.length !== 0 && responded !== undefined) {\n\t\t\t\tQuiz.show(Quiz.responded);\n\t\t\t\tsetText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n\t\t\t\t\ta: responded,\n\t\t\t\t\tb: this.totalStudents\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Should we show the responses?\n\t\t\tif (!this.showResponses && this.quiz.state !== 'reviewing') {\n\t\t\t\tQuiz.hide(Quiz.responseInfo);\n\t\t\t\tQuiz.hide(Quiz.responses);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (document.getElementById(tableId) === null) {\n\t\t\t\tconst html = '<table id=\"' + tableId + '\" class=\"jazzquiz-responses-overview\"></table>';\n\t\t\t\tQuiz.show($('#' + wrapperId).html(html));\n\t\t\t}\n\t\t\tthis.createBarGraph(this.currentResponses, 'current_response', tableId, graphId, rebuild);\n\t\t\tResponseView.sortBarGraph(tableId);\n\t\t}\n\n\t\t/**\n\t\t * Fetch and show results for the ongoing or previous question.\n\t\t * @param {boolean} rebuild If the response graph should be rebuilt or not.\n\t\t */\n\t\trefresh(rebuild) {\n\t\t\tAjax.get('get_results', {}, data => {\n\t\t\t\tthis.quiz.question.hasVotes = data.has_votes;\n\t\t\t\tthis.totalStudents = parseInt(data.total_students);\n\n\t\t\t\tthis.set('jazzquiz_responses_container', 'current_responses_wrapper',\n\t\t\t\t\tdata.responses, data.responded, data.question_type, 'results', rebuild);\n\n\t\t\t\tif (data.merge_count > 0) {\n\t\t\t\t\tQuiz.show($('#jazzquiz_undo_merge'));\n\t\t\t\t} else {\n\t\t\t\t\tQuiz.hide($('#jazzquiz_undo_merge'));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * refresh() equivalent for votes.\n\t\t */\n\t\trefreshVotes() {\n\t\t\t// Should we show the results?\n\t\t\tif (!this.showResponses && this.quiz.state !== 'reviewing') {\n\t\t\t\tQuiz.hide(Quiz.responseInfo);\n\t\t\t\tQuiz.hide(Quiz.responses);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tAjax.get('get_vote_results', {}, data => {\n\t\t\t\tconst answers = data.answers;\n\t\t\t\tconst targetId = 'wrapper_vote_responses';\n\t\t\t\tlet responses = [];\n\n\t\t\t\tthis.respondedCount = 0;\n\t\t\t\tthis.totalStudents = parseInt(data.total_students);\n\n\t\t\t\tfor (let i in answers) {\n\t\t\t\t\tif (!answers.hasOwnProperty(i)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tresponses.push({\n\t\t\t\t\t\tresponse: answers[i].attempt,\n\t\t\t\t\t\tcount: answers[i].finalcount,\n\t\t\t\t\t\tqtype: answers[i].qtype,\n\t\t\t\t\t\tslot: answers[i].slot\n\t\t\t\t\t});\n\t\t\t\t\tthis.respondedCount += parseInt(answers[i].finalcount);\n\t\t\t\t}\n\n\t\t\t\tsetText(Quiz.responded.find('h4'), 'a_out_of_b_voted', 'jazzquiz', {\n\t\t\t\t\ta: this.respondedCount,\n\t\t\t\t\tb: this.totalStudents\n\t\t\t\t});\n\n\t\t\t\tif (document.getElementById(targetId) === null) {\n\t\t\t\t\tconst html = '<table id=\"' + targetId + '\" class=\"jazzquiz-responses-overview\"></table>';\n\t\t\t\t\tQuiz.show(Quiz.responses.html(html));\n\t\t\t\t}\n\n\t\t\t\tthis.createBarGraph(responses, 'vote_response', targetId, 'vote', false);\n\t\t\t\tResponseView.sortBarGraph(targetId);\n\t\t\t});\n\t\t}\n\n\t}\n\n\tclass Instructor {\n\n\t\t/**\n\t\t * @param {Quiz} quiz\n\t\t */\n\t\tconstructor(quiz) {\n\t\t\tthis.quiz = quiz;\n\t\t\tthis.responses = new ResponseView(quiz);\n\t\t\tthis.isShowingCorrectAnswer = false;\n\t\t\tthis.totalQuestions = 0;\n\t\t\tthis.allowVote = false;\n\n\t\t\t$(document).on('keyup', event => {\n\t\t\t\tif (event.keyCode === 27) { // Escape key.\n\t\t\t\t\tInstructor.closeFullscreenView();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$(document).on('click', event => {\n\t\t\t\tInstructor.closeQuestionListMenu(event, 'improvise');\n\t\t\t\tInstructor.closeQuestionListMenu(event, 'jump');\n\t\t\t});\n\n\t\t\tInstructor.addEvents({\n\t\t\t\t'repoll': () => this.repollQuestion(),\n\t\t\t\t'vote': () => this.runVoting(),\n\t\t\t\t'improvise': () => this.showQuestionListSetup('improvise'),\n\t\t\t\t'jump': () => this.showQuestionListSetup('jump'),\n\t\t\t\t'next': () => this.nextQuestion(),\n\t\t\t\t'random': () => this.randomQuestion(),\n\t\t\t\t'end': () => this.endQuestion(),\n\t\t\t\t'fullscreen': () => Instructor.showFullscreenView(),\n\t\t\t\t'answer': () => this.showCorrectAnswer(),\n\t\t\t\t'responses': () => this.responses.toggle(),\n\t\t\t\t'exit': () => this.closeSession(),\n\t\t\t\t'quit': () => this.closeSession(),\n\t\t\t\t'startquiz': () => this.startQuiz()\n\t\t\t});\n\n\t\t\tInstructor.addHotkeys({\n\t\t\t\t't': 'responses',\n\t\t\t\t'r': 'repoll',\n\t\t\t\t'a': 'answer',\n\t\t\t\t'e': 'end',\n\t\t\t\t'j': 'jump',\n\t\t\t\t'i': 'improvise',\n\t\t\t\t'v': 'vote',\n\t\t\t\t'n': 'next',\n\t\t\t\t'm': 'random',\n\t\t\t\t'f': 'fullscreen'\n\t\t\t});\n\t\t}\n\n\t\tstatic addHotkeys(keys) {\n\t\t\tfor (let key in keys) {\n\t\t\t\tif (keys.hasOwnProperty(key)) {\n\t\t\t\t\tkeys[key] = {\n\t\t\t\t\t\taction: keys[key],\n\t\t\t\t\t\trepeat: false // TODO: Maybe event.repeat becomes more standard?\n\t\t\t\t\t};\n\t\t\t\t\t$(document).on('keydown', event => {\n\t\t\t\t\t\tif (keys[key].repeat || event.ctrlKey) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (String.fromCharCode(event.which).toLowerCase() !== key) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet focusedTag = $(':focus').prop('tagName');\n\t\t\t\t\t\tif (focusedTag !== undefined) {\n\t\t\t\t\t\t\tfocusedTag = focusedTag.toLowerCase();\n\t\t\t\t\t\t\tif (focusedTag === 'input' || focusedTag === 'textarea') {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tkeys[key].repeat = true;\n\t\t\t\t\t\tlet $control = Instructor.control(keys[key].action);\n\t\t\t\t\t\tif ($control.length && !$control.prop('disabled')) {\n\t\t\t\t\t\t\t$control.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t$(document).on('keyup', event => {\n\t\t\t\t\t\tif (String.fromCharCode(event.which).toLowerCase() === key) {\n\t\t\t\t\t\t\tkeys[key].repeat = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tstatic addEvents(events) {\n\t\t\tfor (let key in events) {\n\t\t\t\tif (events.hasOwnProperty(key)) {\n\t\t\t\t\t$(document).on('click', '#jazzquiz_control_' + key, () => {\n\t\t\t\t\t\tInstructor.enableControls([]);\n\t\t\t\t\t\tevents[key]();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tstatic get controls() {\n\t\t\treturn $('#jazzquiz_controls_box');\n\t\t}\n\n\t\tstatic get controlButtons() {\n\t\t\treturn Instructor.controls.find('.quiz-control-buttons');\n\t\t}\n\n\t\tstatic control(key) {\n\t\t\treturn $('#jazzquiz_control_' + key);\n\t\t}\n\n\t\tstatic get side() {\n\t\t\treturn $('#jazzquiz_side_container');\n\t\t}\n\n\t\tstatic get correctAnswer() {\n\t\t\treturn $('#jazzquiz_correct_answer_container');\n\t\t}\n\n\t\tstatic get isMerging() {\n\t\t\treturn $('.merge-from').length !== 0;\n\t\t}\n\n\t\tonNotRunning(data) {\n\t\t\tthis.responses.totalStudents = data.student_count;\n\t\t\tQuiz.hide(Instructor.side);\n\t\t\tsetText(Quiz.info, 'instructions_for_instructor');\n\t\t\tInstructor.enableControls([]);\n\t\t\tQuiz.hide(Instructor.controlButtons);\n\t\t\tlet $studentsJoined = Instructor.control('startquiz').next();\n\t\t\tif (data.student_count === 1) {\n\t\t\t\tsetText($studentsJoined, 'one_student_has_joined');\n\t\t\t} else if (data.student_count > 1) {\n\t\t\t\tsetText($studentsJoined, 'x_students_have_joined', 'jazzquiz', data.student_count);\n\t\t\t} else {\n\t\t\t\tsetText($studentsJoined, 'no_students_have_joined');\n\t\t\t}\n\t\t\tQuiz.show(Instructor.control('startquiz').parent());\n\t\t}\n\n\t\tonPreparing(data) {\n\t\t\tQuiz.hide(Instructor.side);\n\t\t\tsetText(Quiz.info, 'instructions_for_instructor');\n\t\t\tlet enabledButtons = ['improvise', 'jump', 'random', 'fullscreen', 'quit'];\n\t\t\tif (data.slot < this.totalQuestions) {\n\t\t\t\tenabledButtons.push('next');\n\t\t\t}\n\t\t\tInstructor.enableControls(enabledButtons);\n\t\t}\n\n\t\tonRunning(data) {\n\t\t\tif (!this.responses.showResponses) {\n\t\t\t\tthis.responses.hide();\n\t\t\t}\n\t\t\tQuiz.show(Instructor.side);\n\t\t\tInstructor.enableControls(['end', 'responses', 'fullscreen']);\n\t\t\tthis.quiz.question.questionTime = data.questiontime;\n\t\t\tif (this.quiz.question.isRunning) {\n\t\t\t\t// Check if the question has already ended.\n\t\t\t\t// We need to do this because the state does not update unless an instructor is connected.\n\t\t\t\tif (data.questionTime > 0 && data.delay < -data.questiontime) {\n\t\t\t\t\tthis.endQuestion();\n\t\t\t\t}\n\t\t\t\t// Only rebuild results if we are not merging.\n\t\t\t\tthis.responses.refresh(!Instructor.isMerging);\n\t\t\t} else {\n\t\t\t\tconst started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n\t\t\t\tif (started) {\n\t\t\t\t\tthis.quiz.question.isRunning = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tonReviewing(data) {\n\t\t\tQuiz.show(Instructor.side);\n\t\t\tlet enabledButtons = ['answer', 'repoll', 'fullscreen', 'improvise', 'jump', 'random', 'quit'];\n\t\t\tif (this.allowVote) {\n\t\t\t\tenabledButtons.push('vote');\n\t\t\t}\n\t\t\tif (data.slot < this.totalQuestions) {\n\t\t\t\tenabledButtons.push('next');\n\t\t\t}\n\t\t\tInstructor.enableControls(enabledButtons);\n\n\t\t\t// In case page was refreshed, we should ensure the question is showing.\n\t\t\tif (!Question.isLoaded()) {\n\t\t\t\tthis.quiz.question.refresh();\n\t\t\t}\n\n\t\t\t// For now, just always show responses while reviewing.\n\t\t\t// In the future, there should be an additional toggle.\n\t\t\tif (this.quiz.isNewState) {\n\t\t\t\tthis.responses.show();\n\t\t\t}\n\t\t\t// No longer in question.\n\t\t\tthis.quiz.question.isRunning = false;\n\t\t}\n\n\t\tonSessionClosed(data) {\n\t\t\tQuiz.hide(Instructor.side);\n\t\t\tQuiz.hide(Instructor.correctAnswer);\n\t\t\tInstructor.enableControls([]);\n\t\t\tthis.responses.clear();\n\t\t\tthis.quiz.question.isRunning = false;\n\t\t}\n\n\t\tonVoting(data) {\n\t\t\tif (!this.responses.showResponses) {\n\t\t\t\tthis.responses.hide();\n\t\t\t}\n\t\t\tQuiz.show(Instructor.side);\n\t\t\tInstructor.enableControls(['quit', 'fullscreen', 'answer', 'responses', 'end']);\n\t\t\tthis.responses.refreshVotes();\n\t\t}\n\n\t\tonStateChange(state) {\n\t\t\t$('#region-main').find('ul.nav.nav-tabs').css('display', 'none');\n\t\t\t$('#region-main-settings-menu').css('display', 'none');\n\t\t\t$('.region_main_settings_menu_proxy').css('display', 'none');\n\t\t\tQuiz.show(Instructor.controlButtons);\n\t\t\tQuiz.hide(Instructor.control('startquiz').parent());\n\t\t}\n\n\t\tonQuestionRefreshed(data) {\n\t\t\tthis.allowVote = data.voteable;\n\t\t}\n\n\t\tonTimerEnding() {\n\t\t\tthis.endQuestion();\n\t\t}\n\n\t\tonTimerTick(timeLeft) {\n\t\t\tsetText(Question.timer, 'x_seconds_left', 'jazzquiz', timeLeft);\n\t\t}\n\n\t\t/**\n\t\t * Start the quiz. Does not start any questions.\n\t\t */\n\t\tstartQuiz() {\n\t\t\tQuiz.hide(Instructor.control('startquiz').parent());\n\t\t\tAjax.post('start_quiz', {}, () => $('#jazzquiz_controls').removeClass('btn-hide'));\n\t\t}\n\n\t\t/**\n\t\t * End the currently ongoing question or vote.\n\t\t */\n\t\tendQuestion() {\n\t\t\tthis.quiz.question.hideTimer();\n\t\t\tAjax.post('end_question', {}, () => {\n\t\t\t\tif (this.quiz.state === 'voting') {\n\t\t\t\t\tthis.responses.showVotesUponReview = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.quiz.question.isRunning = false;\n\t\t\t\t\tInstructor.enableControls([]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Show a question list dropdown.\n\t\t * @param {string} name\n\t\t */\n\t\tshowQuestionListSetup(name) {\n\t\t\tlet $controlButton = Instructor.control(name);\n\t\t\tif ($controlButton.hasClass('active')) {\n\t\t\t\t// It's already open. Let's not send another request.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tAjax.get('list_' + name + '_questions', {}, data => {\n\t\t\t\tlet self = this;\n\t\t\t\tlet $menu = $('#jazzquiz_' + name + '_menu');\n\t\t\t\tconst menuMargin = $controlButton.offset().left - $controlButton.parent().offset().left;\n\t\t\t\t$menu.html('').addClass('active').css('margin-left', menuMargin + 'px');\n\t\t\t\t$controlButton.addClass('active');\n\t\t\t\tconst questions = data.questions;\n\t\t\t\tfor (let i in questions) {\n\t\t\t\t\tif (!questions.hasOwnProperty(i)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet $questionButton = $('<button class=\"btn\"></button>');\n\t\t\t\t\tQuiz.addMathjaxElement($questionButton, questions[i].name);\n\t\t\t\t\t$questionButton.data({\n\t\t\t\t\t\t'time': questions[i].time,\n\t\t\t\t\t\t'question-id': questions[i].questionid,\n\t\t\t\t\t\t'jazzquiz-question-id': questions[i].jazzquizquestionid\n\t\t\t\t\t});\n\t\t\t\t\t$questionButton.data('test', 1);\n\t\t\t\t\t$questionButton.on('click', function () {\n\t\t\t\t\t\tconst questionId = $(this).data('question-id');\n\t\t\t\t\t\tconst time = $(this).data('time');\n\t\t\t\t\t\tconst jazzQuestionId = $(this).data('jazzquiz-question-id');\n\t\t\t\t\t\tself.jumpQuestion(questionId, time, jazzQuestionId);\n\t\t\t\t\t\t$menu.html('').removeClass('active');\n\t\t\t\t\t\t$controlButton.removeClass('active');\n\t\t\t\t\t});\n\t\t\t\t\t$menu.append($questionButton);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Get the selected responses.\n\t\t * @returns {Array.<Object>} Vote options\n\t\t */\n\t\tstatic getSelectedAnswersForVote() {\n\t\t\tlet result = [];\n\t\t\t$('.selected-vote-option').each((i, option) => {\n\t\t\t\tresult.push({\n\t\t\t\t\ttext: option.dataset.response,\n\t\t\t\t\tcount: option.dataset.count\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\n\t\t/**\n\t\t * Start a vote with the responses that are currently selected.\n\t\t */\n\t\trunVoting() {\n\t\t\tconst options = Instructor.getSelectedAnswersForVote();\n\t\t\tconst data = { questions: encodeURIComponent(JSON.stringify(options)) };\n\t\t\tAjax.post('run_voting', data, () => { });\n\t\t}\n\n\t\t/**\n\t\t * Start a new question in this session.\n\t\t * @param {string} method\n\t\t * @param {number} questionId\n\t\t * @param {number} questionTime\n\t\t * @param {number} jazzquizQuestionId\n\t\t */\n\t\tstartQuestion(method, questionId, questionTime, jazzquizQuestionId) {\n\t\t\tQuiz.hide(Quiz.info);\n\t\t\tthis.responses.clear();\n\t\t\tthis.hideCorrectAnswer();\n\t\t\tAjax.post('start_question', {\n\t\t\t\tmethod: method,\n\t\t\t\tquestionid: questionId,\n\t\t\t\tquestiontime: questionTime,\n\t\t\t\tjazzquizquestionid: jazzquizQuestionId\n\t\t\t}, data => this.quiz.question.startCountdown(data.questiontime, data.delay));\n\t\t}\n\n\t\t/**\n\t\t * Jump to a planned question in the quiz.\n\t\t * @param {number} questionId\n\t\t * @param {number} questionTime\n\t\t * @param {number} jazzquizQuestionId\n\t\t */\n\t\tjumpQuestion(questionId, questionTime, jazzquizQuestionId) {\n\t\t\tthis.startQuestion('jump', questionId, questionTime, jazzquizQuestionId);\n\t\t}\n\n\t\t/**\n\t\t * Repoll the previously asked question.\n\t\t */\n\t\trepollQuestion() {\n\t\t\tthis.startQuestion('repoll', 0, 0, 0);\n\t\t}\n\n\t\t/**\n\t\t * Continue on to the next preplanned question.\n\t\t */\n\t\tnextQuestion() {\n\t\t\tthis.startQuestion('next', 0, 0, 0);\n\t\t}\n\n\t\t/**\n\t\t * Start a random question.\n\t\t */\n\t\trandomQuestion() {\n\t\t\tthis.startQuestion('random', 0, 0, 0);\n\t\t}\n\n\t\t/**\n\t\t * Close the current session.\n\t\t */\n\t\tcloseSession() {\n\t\t\tQuiz.hide($('#jazzquiz_undo_merge'));\n\t\t\tQuiz.hide(Question.box);\n\t\t\tQuiz.hide(Instructor.controls);\n\t\t\tsetText(Quiz.info, 'closing_session');\n\t\t\tAjax.post('close_session', {}, () => window.location = location.href.split('&')[0]);\n\t\t}\n\n\t\t/**\n\t\t * Hide the correct answer if showing.\n\t\t */\n\t\thideCorrectAnswer() {\n\t\t\tif (this.isShowingCorrectAnswer) {\n\t\t\t\tQuiz.hide(Instructor.correctAnswer);\n\t\t\t\tQuiz.uncheck(Instructor.control('answer'));\n\t\t\t\tthis.isShowingCorrectAnswer = false;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Request and show the correct answer for the ongoing or previous question.\n\t\t */\n\t\tshowCorrectAnswer() {\n\t\t\tthis.hideCorrectAnswer();\n\t\t\tAjax.get('get_right_response', {}, data => {\n\t\t\t\tQuiz.show(Instructor.correctAnswer.html(data.right_answer));\n\t\t\t\tQuiz.renderAllMathjax();\n\t\t\t\tQuiz.check(Instructor.control('answer'));\n\t\t\t\tthis.isShowingCorrectAnswer = true;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Enables all buttons passed in arguments, but disables all others.\n\t\t * @param {Array.<string>} buttons The unique part of the IDs of the buttons to be enabled.\n\t\t */\n\t\tstatic enableControls(buttons) {\n\t\t\tInstructor.controlButtons.children('button').each((index, child) => {\n\t\t\t\tconst id = child.getAttribute('id').replace('jazzquiz_control_', '');\n\t\t\t\tchild.disabled = (buttons.indexOf(id) === -1);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Enter fullscreen mode for better use with projectors.\n\t\t */\n\t\tstatic showFullscreenView() {\n\t\t\tif (Quiz.main.hasClass('jazzquiz-fullscreen')) {\n\t\t\t\tInstructor.closeFullscreenView();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Hide the scrollbar - remember to always set back to auto when closing.\n\t\t\tdocument.documentElement.style.overflowY = 'hidden';\n\t\t\t// Sets the quiz view to an absolute position that covers the viewport.\n\t\t\tQuiz.main.addClass('jazzquiz-fullscreen');\n\t\t}\n\n\t\t/**\n\t\t * Exit the fullscreen mode.\n\t\t */\n\t\tstatic closeFullscreenView() {\n\t\t\tdocument.documentElement.style.overflowY = 'auto';\n\t\t\tQuiz.main.removeClass('jazzquiz-fullscreen');\n\t\t}\n\n\t\t/**\n\t\t * Close the dropdown menu for choosing a question.\n\t\t * @param {Event} event\n\t\t * @param {string} name\n\t\t */\n\t\tstatic closeQuestionListMenu(event, name) {\n\t\t\tconst menuId = '#jazzquiz_' + name + '_menu';\n\t\t\t// Close the menu if the click was not inside.\n\t\t\tconst menu = $(event.target).closest(menuId);\n\t\t\tif (!menu.length) {\n\t\t\t\t$(menuId).html('').removeClass('active');\n\t\t\t\tInstructor.control(name).removeClass('active');\n\t\t\t}\n\t\t}\n\n\t\tstatic addReportEventHandlers() {\n\t\t\t$(document).on('click', '#report_overview_controls button', function () {\n\t\t\t\tconst action = $(this).data('action');\n\t\t\t\tif (action === 'attendance') {\n\t\t\t\t\t$('#report_overview_responded').fadeIn();\n\t\t\t\t\t$('#report_overview_responses').fadeOut();\n\t\t\t\t} else if (action === 'responses') {\n\t\t\t\t\t$('#report_overview_responses').fadeIn();\n\t\t\t\t\t$('#report_overview_responded').fadeOut();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t}\n\n\treturn {\n\t\tinitialize: function (totalQuestions, reportView, slots) {\n\t\t\tlet quiz = new Quiz(Instructor);\n\t\t\tquiz.role.totalQuestions = totalQuestions;\n\t\t\tif (reportView) {\n\t\t\t\tInstructor.addReportEventHandlers();\n\t\t\t\tquiz.role.responses.showResponses = true;\n\t\t\t\tslots.forEach(slot => {\n\t\t\t\t\tconst wrapper = 'jazzquiz_wrapper_responses_' + slot.num;\n\t\t\t\t\tconst table = 'responses_wrapper_table_' + slot.num;\n\t\t\t\t\tconst graph = 'report_' + slot.num;\n\t\t\t\t\tquiz.role.responses.set(wrapper, table, slot.responses, undefined, slot.type, graph, false);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tquiz.poll(500);\n\t\t\t}\n\t\t}\n\t}\n\n});\n"],"file":"instructor.min.js"}